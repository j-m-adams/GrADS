<!--Copyright (C) 1988-2005 by the Institute of Global Environment and Society (IGES). See file COPYRIGHT for more information.--><title>Shapefiles</title><style type="text/css"><!--.style1 {color: #990000}--></style><H2><strong>The Shapefile</strong> Interface in GrADS</H2><p><strong><a href="#intro">Introduction</a><br /><a href="#whatis">What is a shapefile?</a><br /><a href="#draw">Drawing shapefiles</a><br /><a href="#query">Querying shapefiles</a><br /><a href="#envv">Relevant Environment Variables</a><br /><a href="#writing">Writing shapefiles</a><br /><a href="#examples">Examples</a><br /><a href="#caveat">Caveat</a></strong></p><p><img src="../../assets/colaline.gif" alt="line" width="600" height="4" /><p><em><strong><a name="intro" id="intro"></a>Introduction</strong></em><br />  GrADS version 2.0.a8 introduced the new  capability to  <strong>draw</strong> and <strong>query</strong> the contents of a shapefile; version 2.0.a9 added the capability to <strong>create</strong> new shapefiles from GrADS gridded or station data sets. This documentation page serves as an overview of the GrADS shapefile inteface, providing guidance on what shapefiles are, how to find out what they contain, how to draw their contents, and how to create new shapefiles. <P><em><strong><a name="whatis" id="whatis"></a>What is a Shapefile?</strong></em><br />  The shapefile format (promulgated by <a href="http://esri.com" target="_parent">ESRI</a>) stores non-topological geometry and attribute information for the spatial features in a data set.  Shapefiles are used extensively in Geographic Information Systems (GIS) and they typically contain data related to coastlines, political boundaries, state or county boundaries, climate zones, roads, rivers, topography, etc. The geometry of each spatial feature or 'shape' is stored as a set of vector coordinates. Shapes can be points, lines, or polygons (areas).  An ESRI shapefile actually consists of several files: a main file (*.shp), an index file (*.shx),  a dBASE file (*.dbf), and an optional projection file (*.prj). The main file describes a set of shapes with a list of their vertices. The index file contains offsets pointing to the locations of each shape in the main file. The dBASE file contains attribute data for each shape in the main file. The projection file contains specifics about the spherical geometry; it is an optional but useful component of a shapefile.<P>Some resources for freely available shapefiles are:<ul>  <li><a href="http://www.weather.gov/geodata/" target="_blank">National Weather Service Shapefile Database</a></li>  <li><a href="http://www.nationalatlas.gov/atlasftp.html" target="_blank">National Atlas</a></li>  <li><a href="http://www.diva-gis.org/Data" target="_blank">DIVA-GIS</a></li>  <li><a href="http://www.naturalearthdata.com/downloads/">Natural Earth</a></li></ul><P><a name="draw" id="draw"></a><em><strong>Drawing Shapefiles</strong></em><br />GrADS will draw the contents of a shapefile as an overlay on top of an existing plot with the command <code><a href="gradcomddrawshp.html">draw shp</a></code>. It is necessary to draw a plot first in order to establish the dimensions and scaling of the display. Shapefiles contain 2-dimensional spatial features, so your plot must be varying in the X-Y (lon/lat) domain. <P>A shapefile may contain one of three kinds of graphical elements: points, lines, or polygons. <ul>  <li> For shapefiles that contain points, GrADS will draw a mark at each point location. The mark type and size are controlled by the <code><a href="gradcomdsetshpopts.html">set shpopts</a></code> command, and the color is controlled by the <code><a href="gradcomdsetline.html">set line</a></code> command. </li>  <li>For shapefiles that contain lines, GrADS will draw the line elements using the color, style, and thickness settings that are controlled by the <code><a href="gradcomdsetline.html">set line</a></code> command. </li>  <li>For shapefiles that contain polygons, the default behavior of GrADS is draw only the perimeter of each polygon element.The color, style, and thickness of the polygon perimeters are controlled by the <code><a href="gradcomdsetline.html">set line</a></code> command.  Use  the <code><a href="gradcomdsetshpopts.html">set shpopts</a></code> command to draw filled polygons and set the fill color. </li></ul><p>The <code><a href="gradcomddrawshp.html">draw shp</a></code> command draws all the shapes in the shapefile by default, but it is possible to specify a single shape or a range of shapes to draw. Using these extra arguments to the  <code><a href="gradcomddrawshp.html">draw shp</a></code> command, you can control the line and color characteristics of individual shapes. The <code><a href="gradcomdqshpopts.html">q shpopts</a></code> command lists the current settings for drawing shapefiles. </p><p><a name="query" id="query"></a><em><strong>Querying Shapefiles</strong></em><br />The GrADS shapefile interface also allows the user to discover the contents of a shapefile. The  <code><a href="gradcomdqshp.html">q shp</a></code> command returns information about the shapes in the file (number of vertices and lon/lat bounds), and the  <code><a href="gradcomdqdbf.html">q dbf</a></code> command returns all the attribute information for each shape in the file. </p><p>The first line of the <code><a href="gradcomdqshp.html">q shp</a></code> output contains the shapefile type, the number of shapes in the file, and the X and Y bounds of actual extent of the shapes in the file. Subsequent lines list information about each shape element in the file: the identification number, the shape type, the number of parts, the number of vertices, and the bounds of the shape in the X, Y, Z, and M (measure) dimesions. The  GrADS interface ignores the Z or M values of a shape, only it's position in X,Y (lon,lat) space is relevant. </p><p>The first line of the <code><a href="gradcomdqdbf.html">q dbf</a></code> output contains a comma-delimited list of the names of all the attributes for each record in the database. Subsequent lines contain the comma-delimited list of all the attribute values for each record. </p><p>Please refer to the reference pages for <code><a href="gradcomdqshp.html">q shp</a></code> and <code><a href="gradcomdqdbf.html">q dbf</a></code> for additional information and examples of the output. </p><p><em><strong><a name="envv" id="writing2"></a>Relevant Environment Variables</strong></em><br />When drawing and  querying shapefiles, if you put the  set of component files  (*.shp, *.shx, *.dbf) in the GrADS data directory (specified by the environment variable <a href="gradcomdgrads.html#env"><code>GADDIR</code></a>), then it is not necessary to include the full path when referring to the shapefile. Starting with <span class="style1">GrADS version 2.0.0</span>, a new  environment variable was introduced, <a href="gradcomdgrads.html#env"><code>GASHP</code></a>, for specifiying a list of directories that contain shapefiles. Multiple directories may be included in the GASHP variable -- acceptable delimters are a space, a comma, a semi-colon, and a colon. GrADS will search for the requested shapefile in the directories listed in the <a href="gradcomdgrads.html#env"><code>GASHP</code></a> environment variable before it looks in the <a href="gradcomdgrads.html#env"><code>GADDIR</code></a> directory. Note that GrADS does not use the projection information (*.prj) when drawing the contents of a shapefile. </p><p><em><strong><a name="writing" id="writing"></a>Writing Shapefiles</strong></em><br /> GrADS version 2.0.a9 adds the capability of writing out shapefiles based on gridded or station data sets. The shape types currently supported are points and lines. Point shapes may be created from  station data or from individual grid point values. The GrADS station data format is a natural fit for point shapefiles, but grid point values are also useful in the shapefile format -- they can be used to create a stippled overlay on top of shaded contour plot (see <a href="#examples">Examples</a> below). Line shapes are created by applying the contouring algorithm to a grid expression.  The settings to control contour levels apply when creating line shapefiles. Both point and line shape types are 'measured' in that the data value at each point (or the contour level) are included in the shapefile along with the geographic coordinates. </p><p>To write out a shapefile, there is a new graphics output option, <code><a href="gradcomdsetgxout.html">set gxout shp</a></code>. This graphics  option is used in conjunction with   the <code><a href="gradcomdsetshp.html">set shp</a></code> command which allows the user to set  the filename root  for shapefile output, control the type of shapefile to be created, and set formatting options for numeric values. The <code><a href="gradcomddisplay.html">display</a></code> command  will then create the four shapefile output files instead of drawing a plot. </p><p>The dBase file created with the shapefile contains metadata fields or attributes for each shape. There are three data types for attributes: string, integer, or double. Attributes may be static (the attribute value is the same for each shape) or dynamic (the attribute value varies with shape). A set of attributes (both static and dynamic)  are automatically generated by GrADS for all shapes. Attributes for point shapes from station data are: GrADS version, longitude, latitude, station ID, and the station value. Attributes for point shapes from gridded are: GrADS version, longitude, latitude, and the grid value. Attributes for line shapes (contours) are: GrADS version and the contour value. Additional static attributes for each shape may  be assigned by the user with the <code><a href="gradcomdsetshpattr.html">set shpattr</a></code> command. Numerical attribute values (integers and doubles) are written to the dBase file in text format. The  <code><a href="gradcomdsetshp.html">set shp</a></code> command controls the formatting of the numbers, by specifiying the length of the number (total number of columns) and the precision (number of places to the right of the decimal place, which is only meaningful for attributes of type double). </p><p>The <code><a href="gradcomdqshpopts.html">q shpopts</a></code> command lists the current settings for shapefile output, including the output file name root, the type of shapefile to be created, the formatting of any numeric output, and any user-provided attributes.</p><p> The <code><a href="gradcomdclear.html">clear shp</a></code> command releases all user-defined shapefile attributes from memory, and resets the  output filename root and shapefile type to their default values. The <code><a href="gradcomdreset.html">reset</a></code> and <code><a href="gradcomdreinit.html">reinit</a></code> commands will do the same thing -- use  <code><a href="gradcomdclear.html">clear shp</a></code> if you do not want to reset all the other user settings. </p><p><a name="examples" id="examples"></a><em><strong>Examples </strong></em><br />  <em><strong><br />  </strong></em>Here are two examples showing a series of commands to create  shapefiles: </p><pre>set gxout shpset shp -pt -fmt 8 4 gridptmset shpattr AUTHOR string JMAset shpattr TYPE string grid pointsset shpattr DESC string land surface temperatured maskout(tsfc,landmask-1)  set gxout shpclear shpset shp -ln -fmt 8 4 linemset shpattr AUTHOR string JMAset shpattr TYPE string grid contoursset shpattr DESC string surface temperatured tsfc</pre><p>Here is a slightly more complicated <a href="ftp://iges.org/grads/scripts/shp_demo2.gs">example script</a> that shows how to create a shapefile from a GrADS gridded data set (a GFS precipitation forecast), and then draws the contents of that shapefile as a stippled overlay (with three gray shades) on top of a contour plot of another variable, sea level pressure. The script generates a plot that looks like this:</p><p><img src="shp_demo2.png" alt="shp demo 2" /></p><p>Here is  another <a href="ftp://iges.org/grads/scripts/shp_demo1.gs">example script</a> that shows how to use the shapefile interface to draw U.S. climate divisions colorized according to the values of the Palmer Drought Severity Index (PDSI), and then overlays the 500mb height anomaly (from a GDS data set) for that same month and year. The script generates a plot that looks like this: </p><p><img src="shp_demo1.png" alt="pdsi" /></p><p>The final <a href="ftp://iges.org/grads/scripts/shp_demo3.gs">example script</a> uses shapefiles to draw state and county boundaries as well as roads on a radar image instead of drawing the GrADS map. Here is the result:</p><p><img src="shp_demo3.png" alt="shp demo 3" width="887" height="604" /></p><p>&nbsp;</p><p><em><strong><a name="caveat" id="caveat"></a>Caveat</strong><br /></em>The <a href="http://www.esri.com/library/whitepapers/pdfs/shapefile.pdf">ESRI Shapefile Techncial Description</a> states that <em>&quot;A polygon consists of one or more rings. A ring is a connected sequence of four or more points that form a closed, non-self-intersecting loop.&quot;</em>  A polygon with two rings would look something like a flat donut -- the area between the two rings forms the interior of the polygon, and the area enclosed by the inner ring is actually  in the exterior of the polygon. The GrADS interface does not draw polygons with more than one ring properly. Each ring in a polygon is handled separately; inner rings are drawn as new polygons overlapping the outer ring. If you are drawing a shapefile that contains polygons with more than one ring, and if you use the <code><a href="gradcomdsetshpopts.html">set shpopts</a></code> command to draw filled polygons, then GrADS will draw  both the inner and outer rings as filled polygons. In other words, your donuts will be drawn with filled holes. </p><p>The rings of a polygon are referred to as its parts, and the number of parts in each polygon is included in the ouput of the <code><a href="gradcomdqshp.html">q shp</a></code> command. So it is possible to discover whether this limitation is affecting your plot. </p>